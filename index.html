<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cerulean - Shopping Trip Planner</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>
  <!-- Launch Screen -->
  <div id="launch-screen" class="launch-screen">
    <div class="launch-content">
      <div class="logo-container">
        <img src="assets/images/branding/Cerulean-logo.svg" alt="Cerulean Logo" class="launch-logo">
      </div>
      <button id="start-app-btn" class="start-button">
        <span>Shop with less stress</span>
        <i data-feather="arrow-right"></i>
      </button>
    </div>
  </div>

  <div class="app-container">
    <!-- Onboarding Screen (inside app container) -->
    <div id="onboarding-screen" class="onboarding-screen hidden">
      <div class="onboarding-content">
        <div class="onboarding-header">
          <div class="onboarding-title">Welcome to Cerulean.</div>
          <p>Let's destress your next shopping trip</p>
        </div>
        
        <!-- All Steps on One Page -->
        <div class="onboarding-steps">
          <!-- Step 1: Department Selection -->
          <div class="onboarding-step">
            <div class="step-header">
              <div class="step-icon">
                <i data-feather="shopping-bag"></i>
              </div>
              <div class="step-content">
                <h3>Select department</h3>
              </div>
            </div>
            
            <div class="form-section">
              <div class="department-presets">
                <label class="department-preset">
                  <input type="checkbox" name="department" value="womens" checked>
                  <span>Women's</span>
                </label>
                <label class="department-preset">
                  <input type="checkbox" name="department" value="mens">
                  <span>Men's</span>
                </label>
                <label class="department-preset">
                  <input type="checkbox" name="department" value="unisex">
                  <span>Unisex</span>
                </label>
              </div>
            </div>
          </div>
          
          <!-- Step 2: Body Measurements -->
          <div class="onboarding-step">
            <div class="step-header">
              <div class="step-icon">
                <i class="fa-solid fa-shirt shirt-outline"></i>
              </div>
              <div class="step-content">
                <h3>Choose clothing sizes</h3>
              </div>
            </div>
            
            <div class="form-section">
              <div class="input-group">
                <label for="top-size">Top Size</label>
                <div class="select-wrapper">
                  <select id="top-size" name="topSize" class="form-select">
                    <option value="">Select size</option>
                    <option value="xs">XS</option>
                    <option value="s">S</option>
                    <option value="m" selected>M</option>
                    <option value="l">L</option>
                    <option value="xl">XL</option>
                    <option value="xxl">XXL</option>
                  </select>
                  <i class="fa-solid fa-chevron-down select-caret"></i>
                </div>
              </div>
              
              <div class="input-group">
                <label for="bottom-size">Bottom Size</label>
                <div class="select-wrapper">
                  <select id="bottom-size" name="bottomSize" class="form-select">
                    <option value="">Select size</option>
                    <option value="28">28</option>
                    <option value="29">29</option>
                    <option value="30" selected>30</option>
                    <option value="31">31</option>
                    <option value="32">32</option>
                    <option value="33">33</option>
                    <option value="34">34</option>
                    <option value="36">36</option>
                    <option value="38">38</option>
                    <option value="40">40</option>
                    <option value="42">42</option>
                  </select>
                  <i class="fa-solid fa-chevron-down select-caret"></i>
                </div>
              </div>
              
              <div class="input-group">
                <label for="shoe-size">Shoe Size</label>
                <div class="select-wrapper">
                  <select id="shoe-size" name="shoeSize" class="form-select">
                    <option value="">Select size</option>
                    <option value="5">5</option>
                    <option value="5.5">5.5</option>
                    <option value="6">6</option>
                    <option value="6.5">6.5</option>
                    <option value="7">7</option>
                    <option value="7.5">7.5</option>
                    <option value="8">8</option>
                    <option value="8.5" selected>8.5</option>
                    <option value="9">9</option>
                    <option value="9.5">9.5</option>
                    <option value="10">10</option>
                    <option value="10.5">10.5</option>
                    <option value="11">11</option>
                    <option value="11.5">11.5</option>
                    <option value="12">12</option>
                  </select>
                  <i class="fa-solid fa-chevron-down select-caret"></i>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Step 3: Budget -->
          <div class="onboarding-step">
            <div class="step-header">
              <div class="step-icon">
                <i data-feather="dollar-sign"></i>
              </div>
              <div class="step-content">
                <h3>Set budget per item</h3>
                <p>This can be a rough estimate and you can change it later.</p>
              </div>
            </div>
            
            <div class="form-section">
              <div class="input-group">
                <label for="budget">Maximum budget per item ($)</label>
                <input type="number" id="budget" name="budget" class="form-input" placeholder="e.g., 150" min="0" step="10">
                <script>document.getElementById('budget').value = 120;</script>
              </div>
      
            </div>
          </div>
          
          <!-- Step 4: Location Consent -->
          <div class="onboarding-step">
            <div class="step-header">
              <div class="step-icon">
                <i data-feather="map-pin"></i>
              </div>
              <div class="step-content">
                <h3>Location consent</h3>
                <p>Allow us to show directions and find what’s available at nearby stores</p>
              </div>
            </div>
            
            <div class="form-section">
              <div class="consent-section">
                <p class="consent-text">We anonymize your data before sharing it with retailers. This allows them to see bigger patterns, like who's coming in and what they're looking for. Your personal details are never shared.</p>
                
                <div class="checkbox-group">
                  <label class="checkbox-option">
                    <input type="checkbox" name="locationConsent" value="true" checked>
                    <span class="checkmark"></span>
                    <span class="label-text">I agree to share my location with Cerulean</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Get Started Button -->
        <button id="get-started-btn" class="get-started-button">
          <span>Finish Setup</span>
        </button>
      </div>
    </div>
    <!-- Location Section -->
    <div id="location-bar" class="location-bar">
      <i data-feather="shopping-bag"></i>
      <span class="location-text">Long Island, New York</span>
    </div>
    <!-- Accent Heading -->
    <div class="accent-heading">Let’s start curating.</div>
    <!-- SearchBar Component Mount Point -->
    <div id="searchbar-container"></div>
      <!--
      <div id="example-searches-container" class="example-searches-container">
        <div class="example-searches-scroll">
          <span class="example-search">white cotton tees that I can wear for walking to class in a Philly summer</span>
          <span class="example-search">navy button down shirts for a Catholic  summer wedding in Quito</span>
          <span class="example-search">formal cream dress for 28 y.o. women for a barn wedding in TX this weekend</span>
          <span class="example-search">bags that go well with linen pants for summer in Tuscany</span>
        </div>
      </div>
      -->
      <!-- Refine Description (shown only during refine step) -->
      <div id="refine-desc" class="refine-desc hidden">
        <p>
          Let’s refine the style you’re looking for.
        </p>
        <p>Choose up to 3 images that speak to you.</p>
      </div>
      <!-- Refine Page Back Button Bar (fixed position) -->
      <div class="back-btn-bar hidden" id="back-btn-bar-refine" data-back="refine">
        <button class="back-btn" id="back-btn-refine"><i data-feather="arrow-left"></i></button>
        <button class="filter-btn" id="filter-btn-refine"><i data-feather="sliders"></i></button>
      </div>
      
    <!-- Refine Page (SPA style) -->
    <div id="refine-page" class="hidden">
      <div id="refine-image-grid"></div>
        <button
          id="finish-refine-btn"
          class="primary-btn"
          style="margin-top: 24px"
        >
          Finish Refine
        </button>
    </div>
    <!-- Products Page (SPA style) -->
    <div id="products-page" class="hidden">
        <div class="back-btn-bar hidden" id="back-btn-bar-products" data-back="products">
          <div class="products-bar-buttons">
          <button class="back-btn" id="back-btn-products"><i data-feather="arrow-left"></i></button>
          <button class="filter-btn" id="filter-btn-products"><i data-feather="sliders"></i></button>
          </div>
          <div class="products-heading-row"><span class="products-heading">My Match List</span></div>
        </div>
      <div id="product-list"></div>
      <button id="preview-trip-btn" class="hidden floating-trip-btn">
        <span class="trip-btn-icon"><i class="fa-solid fa-list"></i></span>
        <span class="trip-btn-label">View Trip List</span>
        <span class="trip-btn-badge" id="trip-btn-badge">0</span>
      </button>
      </div>
      <!-- Map Page (SPA style) -->
      <div id="map-page" class="hidden">
        <h2>Store Map</h2>
        <div
          id="map-container"
          style="
            width: 100%;
            height: 250px;
            background: repeating-linear-gradient(
              45deg,
              #e0e0e0,
              #e0e0e0 10px,
              #fff 10px,
              #fff 20px
            );
            position: relative;
          "
        ></div>
        <p>This is your trip plan map. (Mockup)</p>
      </div>
      <!-- Profile Page (SPA style) -->
      <div id="profile-page" class="hidden">
        <h2>Profile</h2>
        <div id="profile-info">
          <p><strong>Name:</strong> Jane Doe</p>
          <p><strong>Email:</strong> jane.doe@example.com</p>
          <p><strong>Favorite Style:</strong> Modern Business</p>
          <p>This is a mockup profile page.</p>
        </div>
    </div>
    <!-- Trip Plan Overlay Sheet -->
    <div id="trip-sheet-overlay" class="filter-overlay hidden"></div>
    <div id="trip-overlay" class="filter-sheet hidden">
      <div class="filter-sheet-header">
        <div class="trip-sheet-header-stack">
          <h3 id="trip-sheet-title">Trip List for Friday, July 11th</h3>
          <div id="trip-sheet-meta" style="margin-bottom: 0; color: #555; font-size: 1rem;"></div>
        </div>
        <button id="close-overlay-btn" class="close-filter-btn"><i data-feather="x"></i></button>
      </div>
      <div class="filter-sheet-content">
        <div id="trip-list"></div>
      </div>
    </div>
    <!-- Map Overlay Sheet -->
    <div id="map-overlay" class="overlay hidden">
      <div class="overlay-content">
        <h2>Store Map</h2>
        <div id="map-container"></div>
        <button id="close-map-btn">Close</button>
      </div>
    </div>
      
      <!-- Filter Sheet Component Mount Point -->
      <div id="filter-sheet-container"></div>
  </div>
  <!-- NavBar Component Mount Point -->
  <div id="navbar-container"></div>
  <script src="app.js"></script>
  <script type="module">
      import { renderNavBar } from "./components/NavBar.js";
      import { renderSearchBar } from "./components/SearchBar.js";
      import { renderFilterSheet, initializeFilterSheet } from "./components/FilterSheet.js";
      window.addEventListener("DOMContentLoaded", () => {
      function waitForRenderProducts(callback) {
        if (window.renderProducts && window.PRODUCTS) {
          callback();
        } else {
          setTimeout(() => waitForRenderProducts(callback), 50);
        }
      }
      function hideSearchUI() {
          document
            .getElementById("searchbar-container")
            .classList.add("hidden");
          const accent = document.querySelector(".accent-heading");
          if (accent) accent.classList.add("hidden");
          const toggleRow = document.getElementById("search-toggle-row");
          if (toggleRow) toggleRow.classList.add("hidden");
          const locationBar = document.getElementById("location-bar");
          if (locationBar) locationBar.classList.add("hidden");
      }
      function showSearchUI() {
          document
            .getElementById("searchbar-container")
            .classList.remove("hidden");
          const accent = document.querySelector(".accent-heading");
          if (accent) accent.classList.remove("hidden");
          const toggleRow = document.getElementById("search-toggle-row");
          if (toggleRow) toggleRow.classList.remove("hidden");
          const locationBar = document.getElementById("location-bar");
          if (locationBar) locationBar.classList.remove("hidden");
      }
      // SPA: go to refine page after search
      function goToProductsPage(query) {
          window.justSearched = true;
          window.lastSearchQuery = query;
          if (window.showScreen) window.showScreen('refine');
        // Render refine image grid
        const grid = document.getElementById('refine-image-grid');
        grid.innerHTML = '';
        const selected = new Set();
          (window.REFINE_IMAGES || []).forEach(img => {
          const tile = document.createElement('div');
          tile.className = 'refine-image-tile';
            tile.innerHTML = `<img src="${img.image}" alt="${img.alt || ''}" title="${img.alt || ''}" />`;
          tile.onclick = () => {
              if (tile.classList.contains('selected')) {
                // Deselect
                tile.classList.remove('selected');
                selected.delete(img.id);
              } else {
                // Only allow up to 3 selections
                if (selected.size < 3) {
                  tile.classList.add('selected');
                  selected.add(img.id);
                }
              }
          };
          grid.appendChild(tile);
        });
        // Finish Refine button logic
        const finishBtn = document.getElementById('finish-refine-btn');
        finishBtn.onclick = () => {
            if (window.showScreen) window.showScreen('products');
            // Gather selected refine image IDs
            const selectedIds = Array.from(selected);
            // Map to product IDs
            let productIds = [];
            selectedIds.forEach(refineId => {
              if (window.REFINE_TO_PRODUCTS && window.REFINE_TO_PRODUCTS[refineId]) {
                productIds = productIds.concat(window.REFINE_TO_PRODUCTS[refineId]);
              }
            });
            // Remove duplicates
            productIds = [...new Set(productIds)];
            // If less than 3, add random products not already selected
            let filteredProducts;
            filteredProducts = (window.PRODUCTS || []).filter(p => productIds.includes(p.id));
            if (filteredProducts.length < 3) {
              // Get products not already selected
              const notSelected = (window.PRODUCTS || []).filter(p => !productIds.includes(p.id));
              // Add up to two unselected products (not random)
              filteredProducts = filteredProducts.concat(notSelected.slice(0, 3 - filteredProducts.length));
            }
            // Only show up to 3 products
            filteredProducts = filteredProducts.slice(0, 3);
            // Store for session
            window.lastProductSelection = filteredProducts.map(p => p.id);
          waitForRenderProducts(() => {
              window.renderProducts(filteredProducts);
          });
        };
      }
        // Add back button logic for all pages
        document.querySelectorAll('.back-btn-bar').forEach(bar => {
          const btn = bar.querySelector('.back-btn');
          btn.onclick = () => {
            // Hide all back bars
            document.querySelectorAll('.back-btn-bar').forEach(b => b.classList.add('hidden'));
            // Go to the appropriate screen
            const type = bar.getAttribute('data-back');
            if (window.showScreen) {
              if (type === 'refine') window.showScreen('search');
              else if (type === 'products') window.showScreen('refine');
              else if (type === 'map') window.showScreen('products');
              else if (type === 'profile') window.showScreen('products');
            }
        };
        if (window.feather) window.feather.replace();
        });
        renderNavBar("navbar-container");
        renderSearchBar("searchbar-container", goToProductsPage);
        
        // Render FilterSheet component
        const filterSheetContainer = document.getElementById("filter-sheet-container");
        if (filterSheetContainer) {
          filterSheetContainer.innerHTML = renderFilterSheet();
          // Initialize filter sheet functionality after rendering
          initializeFilterSheet();
        }
        
        // Initialize app but don't show search screen by default (wait for onboarding)
        // setTimeout(() => {
        //   if (window.showScreen) {
        //     window.showScreen('search');
        //   }
        // }, 100);

        // Add filter button logic for refine and products pages
        const filterBtnRefine = document.getElementById('filter-btn-refine');
        if (filterBtnRefine) {
          filterBtnRefine.onclick = () => {
            const filterSheetContainer = document.getElementById("filter-sheet-container");
            if (filterSheetContainer) {
              filterSheetContainer.innerHTML = renderFilterSheet();
              initializeFilterSheet();
              // Show overlay and sheet
              const filterSheet = document.getElementById('filter-sheet');
              const filterOverlay = document.getElementById('filter-overlay');
              if (filterSheet && filterOverlay) {
                filterSheet.classList.remove('hidden');
                filterOverlay.classList.remove('hidden');
                setTimeout(() => {
                  filterSheet.classList.add('show');
                  filterOverlay.classList.add('show');
                }, 10);
              }
            }
          };
        }
        const filterBtnProducts = document.getElementById('filter-btn-products');
        if (filterBtnProducts) {
          filterBtnProducts.onclick = () => {
            const filterSheetContainer = document.getElementById("filter-sheet-container");
            if (filterSheetContainer) {
              filterSheetContainer.innerHTML = renderFilterSheet();
              initializeFilterSheet();
              // Show overlay and sheet
              const filterSheet = document.getElementById('filter-sheet');
              const filterOverlay = document.getElementById('filter-overlay');
              if (filterSheet && filterOverlay) {
                filterSheet.classList.remove('hidden');
                filterOverlay.classList.remove('hidden');
                setTimeout(() => {
                  filterSheet.classList.add('show');
                  filterOverlay.classList.add('show');
                }, 10);
              }
            }
          };
        }
    });
  </script>
</body>
</html>
